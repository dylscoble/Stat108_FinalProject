---
title: "Stat108_FinalProject"
author: "Dylan Scoble and Aisha Lakshman"
date: "2/4/2022"
output: pdf_document
---


# Introduction

In the 2004 documentary Super Size Me, writer and director Morgan Spurlock took on a month-long challenge to only eat McDonalds food. Spurlock experienced a multitude of health issues, including weight gain, cholesterol spike, and negative impacts on his energy and mood, demonstrating the fast-food chains’ instrumental role in America’s obesity epidemic (Stossel 2006). Spurlock’s film not only emphasized the consequences of caloric intake, but also brought light to the nutritional attributes of McDonalds menu items that caused adverse health effects. There are many factors that impact the quality and quantity of calories, such as levels of fat, protein, and carbohydrates, which is why many dieticians support the notion that  “not all calories are created equal” (Tolar-Peterson, 2021). Spurlock’s documentary and existing literature inspired an investigation of McDonalds menu items’ caloric and nutritional records. Our research will address the following question: What nutritional attribute is the best predictor of calories for the McDonalds menu items? Since drink and food items have quite different caloric makeups, we are dividing our dataset between food menu items (Breakfast, Beef & Pork, Chicken & Fish, Salads, Snacks & Sides, Desserts) and drink menu items (Coffee and Tea, Smoothies and Shakes, Beverages). For food menu items, we hypothesize total carbohydrates (grams) is the most accurate predictor of calories. For drink menu items, we hypothesize that total sugar (grams) is the most accurate predictor of calories. We will analyze a 2018 dataset from Kaggle titled “Nutritional Facts for McDonald's Menu” to answer our research question. Our chosen dataset provides nutritional information for all of McDonald’s menu items, including calories, saturated fat, and cholesterol levels. We will create a linear model for each nutritional attribute with calories as the response variable for each predictor. A linear model for regression analysis is useful in answering our question because it will allow us to confidently determine what nutritional attributes matter the most for calories and predict an item’s calorie count based on its predictors.


### References

Tolar-Peterson, Terezie. 2021. “Not all calories are created equal - a dietician explains the different ways the kinds of foods you eat matter to your body”. The Conversation. Retrieved Febuary 8th, 2022. https://theconversation.com/not-all-calories-are-equal-a-dietitian-explains-the-different-ways-the-kinds-of-foods-you-eat-matter-to-your-body-156900
 
Stossel, John. 2006. “‘Super Size Me’ Carries Weight With Critics”. ABC News. Retrieved Febuary 8th, 2022. https://docs.google.com/document/d/1XB-22QylvnbasBKe7n_DfkkENcZWRvIR5X8vZgOK6LY/edit#

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(broom)
library(cowplot)
library(patchwork)
library(leaps)
library(rms)
library(modelr)
```


# Our Data

```{r}
data <- read.csv("data/menu 2.csv")
glimpse(data)
```

# Exploratory Data Analysis

For this project, we understand that foods and beverages may have different predictors for their number of calories. Therefore, we will be splitting our dataset into two different dataframes: one for foods, and one for beverages.

We will also be removing all predictors that have "as % of Daily Value" attached at the end, since our purpose is not focused the daily values of the nutrients. These predictors add no value to our dataset or models.

The first thing we are doing is filtering out Total Fat (% Daily Value), Saturated Fat (% Daily Value), Cholesterol (% Daily Value), Sodium (% Daily Value), Carbohydrataes (% Daily Value), Dietary Fiber (% Daily Value) from our nutritional attributes. These attributes don’t aid to answering our research question, so we are taking these predictor variables out of consideration. 

```{r}
data <- data %>% 
  select(Category, Item, Serving.Size, Calories, Calories.from.Fat, Total.Fat,
         Saturated.Fat, Trans.Fat, Cholesterol, Sodium, Carbohydrates,
         Dietary.Fiber, Sugars, Protein, Vitamin.A....Daily.Value.,
         Vitamin.C....Daily.Value., Calcium....Daily.Value., Iron....Daily.Value.)

glimpse(data)
```


```{r}
count(data, Category)
```

Next, we are dividing our categorical variables between food items (Breakfast, Beef & Pork, Chicken & Fish, Salads, Snacks & Sides, Desserts) and drink items (Coffee and Tea, Smoothies and Shakes, Beverages).

```{r}
food_data <- data %>% 
  filter(Category == "Beef & Pork" |
         Category == "Breakfast" |
         Category == "Chicken & Fish" |
         Category == "Desserts" |
         Category == "Salads" |
         Category == "Snacks & Sides")

bev_data <- data %>%
  filter(Category == "Beverages" |
         Category == "Coffee & Tea" |
         Category == "Smoothies & Shakes")
```

 
### Response Variable

The next step is to create histograms for occurences of food items (food_data) and occurences of drink items (bev_data) against our response variable (calories). Based on the plots below, it seems that for both datasets, the Calories variable follows a normal distribution.

```{r}
ggplot(data=food_data, aes(x=Calories)) +
  geom_histogram() +
  labs(title="Histogram of Response Variable",
       x="Number of Calories",
       y="Number of Occurrences")

ggplot(data=bev_data, aes(x=Calories)) +
  geom_histogram() +
  labs(title="Histogram of Response Variable",
       x="Number of Calories",
       y="Number of Occurrences")
```

Now we calculate the appropriate summary statistics for calories (mean, median, standard deviation, IQR) for food items and drink items.

```{r}
food_data %>% 
  summarise(mean = mean(Calories),
            median = median(Calories),
            std_dev = sd(Calories),
            iqr = IQR(Calories))

bev_data %>% 
  summarise(mean = mean(Calories),
            median = median(Calories),
            std_dev = sd(Calories),
            iqr = IQR(Calories))
```

### Model Selection with AIC
The code below creates a linear model for McDonalds food menu items and displays the model output.  

```{r}
food_model = lm(Calories ~ Total.Fat + Saturated.Fat + Trans.Fat + Cholesterol + Sodium + Carbohydrates +
         Dietary.Fiber + Sugars + Protein + Vitamin.A....Daily.Value. +
         Vitamin.C....Daily.Value. + Calcium....Daily.Value. + Iron....Daily.Value., data = food_data)

tidy(food_model, conf.int = TRUE) %>% 
  kable(format="markdown", digits = 5)
```

The code below creates a linear model for McDonald's drink menu items and displays the model output.

```{r}
bev_model = lm(Calories ~ Total.Fat + Sodium + Carbohydrates + Sugars + Protein + Vitamin.A....Daily.Value. +
         Vitamin.C....Daily.Value. + Calcium....Daily.Value. + Iron....Daily.Value., data = bev_data)

tidy(bev_model, conf.int = TRUE) %>% 
  kable(format="markdown", digits = 5)
```

Now, we will select a model for food items using AIC. We are using the step function in R to conduct backward selection using AIC as the selection criterion, and storing the selected model as food_model_select_aic. Finally, we display the coefficients of the selected model.  

```{r}
food_model_select_aic <- step(food_model, direction = "backward")
tidy(food_model_select_aic) %>% 
  kable(format="markdown", digits=3)

coef(food_model_select_aic, 4)
```
For food products, the predictors that give us the best model for predicting calorie count are:
  -Total.Fat
  -Saturated.Fat
  -Trans.Fat
  -Cholesterol
  -Sodium
  -Carbohydrates
  -Dietary.Fiber
  -Sugars
  -Protein
  -Vitamin.A….Daily.Value.
  -Vitamin.C….Daily.Value.
  -Calcium….Daily.Value.
  -Iron….Daily.Value.
  
Now, we will select a model for drink items using AIC. We are using the step function in R to conduct backward selection using AIC as the selection criterion, and storing the selected model as bev_model_select_aic. Finally, we display the coefficients of the selected model.

```{r}
bev_model_select_aic <- step(bev_model, direction = "backward")
tidy(bev_model_select_aic) %>% 
  kable(format="markdown", digits=3)

coef(bev_model_select_aic, 4)
```
For Beverages, the predictors that give us the best model for predicting calorie count are:
  -Total.Fat
  -Sodium
  -Carbohydrates
  -Sugars
  -Protein
  -Vitamin.A….Daily.Value.
  -Vitamin.C….Daily.Value.
  -Calcium….Daily.Value.
  -Iron….Daily.Value.


The code and its output below show us that the best predictors of food calories in order are Total Fat, Carbohydrates, and Protein.
```{r}
food_models <- regsubsets(Calories ~ Total.Fat + Saturated.Fat + Trans.Fat + Cholesterol + Sodium + Carbohydrates +
         Dietary.Fiber + Sugars + Protein + Vitamin.A....Daily.Value. +
         Vitamin.C....Daily.Value. + Calcium....Daily.Value. + Iron....Daily.Value., data = food_data, method="backward")
summary(food_models)
```


The code and its output below show us that the best predictors of beverage calories in order are  Carbohydrates, Total Fat, and Protein
```{r}
bev_models <- regsubsets(Calories ~ Total.Fat + Saturated.Fat + Trans.Fat + Cholesterol + Sodium + Carbohydrates +
         Dietary.Fiber + Sugars + Protein + Vitamin.A....Daily.Value. +
         Vitamin.C....Daily.Value. + Calcium....Daily.Value. + Iron....Daily.Value., data = bev_data, method="backward")
summary(bev_models)
```

When first starting the analysis we decided to divide our data between food and drink items on the assumption that they have different caloric makeups. We split our dataset between food menu items (Breakfast, Beef & Pork, Chicken & Fish, Salads, Snacks & Sides, Desserts) and drink menu items (Coffee and Tea, Smoothies and Shakes, Beverages). For food menu items, we hypothesized total carbohydrates (grams) was the most accurate predictor of calories. For drink menu items, we hypothesized that total sugar (grams) was the most accurate predictor of calories. Upon completing Exploratory Data Analysis, Regression, and Model Selection, our final models (food_model_aic and bev_model_aic) indicated that best 3 predictors (nutritional attributes) were the same for food and beverage items. We then decided it would be best for our final model to encompass food and beverage data together. Our modeling objective benefits from a bigger dataset, as predictions are more accurate when working with a bigger dataset.

### Model Selection with K-fold Cross Validoation

We will be comparing the predictors mentioned above regarding their relationship to Calories. For food and beverages, we will create four models each: one with each variable as the singular predictor. We will compare these models using K-fold Cross Validation, where k = 5.

```{r}
set.seed(5747108)
folded_data <- crossv_kfold(data, 5)
```

Testing the Total Fat predictor:
```{r}
models_fat <- map(folded_data$train, 
              ~ lm(Calories ~ Total.Fat, data = .))
models_fat
```

```{r}
train_mse_fat <- map2_dbl(models_fat, folded_data$train, mse)
test_mse_fat <- map2_dbl(models_fat, folded_data$test, mse)

fat <- tibble(
  1:5,
  train_mse_fat, 
  test_mse_fat
)

fat %>%
  summarise(mean_train_mse = mean(train_mse_fat), 
           mean_test_mse = mean(test_mse_fat))
```

Testing the Carbohydrates predictor:
```{r}
models_carb <- map(folded_data$train, 
              ~ lm(Calories ~ Carbohydrates, data = .))
models_carb
```

```{r}
train_mse_carb <- map2_dbl(models_carb, folded_data$train, mse)
test_mse_carb <- map2_dbl(models_carb, folded_data$test, mse)

carb <- tibble(
  test_fold = 1:5,
  train_mse_carb, 
  test_mse_carb
)

carb %>%
  summarise(mean_train_mse = mean(train_mse_carb), 
           mean_test_mse = mean(test_mse_carb))

```


Testing the Protein predictor:
```{r}
models_protein <- map(folded_data$train, 
              ~ lm(Calories ~ Protein, data = .))
models_protein
```

```{r}
train_mse_protein <- map2_dbl(models_protein, folded_data$train, mse)
test_mse_protein <- map2_dbl(models_protein, folded_data$test, mse)

protein <- tibble(
  1:5,
  train_mse_protein, 
  test_mse_protein
)

protein %>%
  summarise(mean_train_mse = mean(train_mse_protein), 
           mean_test_mse = mean(test_mse_protein))
```

From our K-fold cross validation test, we can conclude that Total Fat is the best singular predictor of Calories, which goes against our hypothesis. We see that Protein and Carbohydrates have similar effectiveness in predicting calories, but total fat content is about twice as effective. 

# Final Model

The final model for our project represents calories as a linear function of Total Fat. The equation for this relationship is $Calories = 15.297 * Total.Fat + 151.588$. 
```{r}
final_model <- lm(Calories ~ Total.Fat, data=data)

tidy(final_model) %>% 
  kable(format="markdown", digits = 5)
```

### Checking the Linearity Assumption

```{r}
final_model <- augment(final_model, type.predict = "response",type.residuals = "deviance")
glimpse(final_model)
```

Based on the plot below, the normality assumption is satisfied because our model's residuals follow a normal distribution with mean zero.
```{r}
hist(final_model$.resid)
```


Based on the plot below, the constant variance assumption is satisfied because there is no fan pattern when comparing our fitted values to our residuals. The variance remains relatively constant throughout all of our model's fitted values, despite some outliers.
```{r}
ggplot(data = final_model, aes(x=.fitted, y=.resid)) +
  geom_point() +
  labs(title="Residuals vs Predicted Values",
       x="Fitted Values",
       y="Residuals")
```

Based on the plot below, the linearity assumption is satisfied because there is a very clear linear relationship between our fitted values and our predictor. This is obvious because our model is a linear relationship between only one predictor and the response variable.
```{r}
ggplot(data = final_model, aes(x=.fitted, y=Total.Fat)) +
  geom_point() +
  labs(title="Fitted Values vs Total Fat",
       x="Fitted Values",
       y="Total Fat")
```


